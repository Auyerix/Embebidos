/*
 * API_scheduler.c
 *
 *  Created on: Nov 30, 2023
 *      Author: osboxes
 */

#include "API_scheduler.h"
#include "main.h"
#include "BMP180.h"

extern TIM_HandleTypeDef htim10;

static bool_t schedulerFlag = false;

float pressure[4] = {0};
float temperature[4] = {0};


void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim){

	static uint16_t count = 0;
	HAL_GPIO_TogglePin(LD2_GPIO_Port, LD2_Pin);
	if(count==3){
		//HAL_GPIO_TogglePin(LD4_GPIO_Port, LD4_Pin);
		schedulerFlag = true;
		count = 0;
	}
	count++;

}

bool_t readSensor(void){

	if(schedulerFlag){
		schedulerFlag = false;
		HAL_GPIO_TogglePin(LD4_GPIO_Port, LD4_Pin);

		temperature[3] = temperature[2];
		temperature[2] = temperature[1];
		temperature[1] = temperature[0];

		pressure[3] = pressure[2];
		pressure[2] = pressure[1];
		pressure[1] = pressure[0];


		temperature[0] = BMP180_GetTemp();
		pressure[0] = BMP180_GetPress (0);
		return true;
	}
	return false;
}

void readData(float *temp)
{
    *temp = temperature;

}


